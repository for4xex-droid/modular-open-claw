---
description: AI自身による自己批判・修正ループ。コード品質を極限まで高める。
---

# /reflexion - セルフレビューループ

作成されたコード（または指定されたファイル）に対して、AI自身が「鬼のレビュアー」となり、合格点が出るまで修正を繰り返すワークフロー。
Sequential Thinking MCPを利用して、思考プロセスを厳格に管理します。

## 🎯 目的
LLMの確率的な誤りや幻覚（Hallucination）を排除し、Golden Ruleに準拠した最高品質のコードを生成する。

## 🔄 実行プロセス

**Sequential Thinking** ツールを使用して、以下のサイクルを実行してください。
**ループ上限**: 最大3回（無限ループ防止のため）

### Phase 1: 批評 (Critique) 🧐
現状のコードを、外部の厳しいレビュアーの視点で分析します。

- **Golden Rule Check**: Memory MCPを参照し、プロジェクトのルール（unwrap禁止、型強制など）を守っているか？
- **Security Check**: インジェクション、パニック、危険な操作はないか？
- **Edge Case Check**: 空データ、境界値、異常系エラーハンドリングは適切か？

### Phase 2: 判定 (Judge) ⚖️
コードの品質を0〜100点でスコア付けします。

- **合格ライン**: **95点以上**
- **却下**: 95点未満なら Phase 3 へ。
- **打ち止め**: 3回目のループなら、スコアに関わらず Phase 4 へ（「これ以上の改善は困難」と判断）。

### Phase 3: 修正 (Refine) 🛠️
指摘された問題点を修正するコードを生成し、適用します。
修正後、再び Phase 1 に戻ります。

### Phase 4: 完了 (Finalize) ✅
最終的なコードと、実施した改善内容の要約を報告します。

## 📝 使用例

```bash
# 特定のファイルに対して実行
/reflexion src/main.rs

# 直前の生成コードに対して実行
/reflexion
```

## AIへのプロンプト（内部思考用）

```text
あなたは妥協を知らないシニアエンジニアです。
自分の書いたコードであっても、以下の観点で厳しくレビューしてください。

1. Memory MCPからGolden Ruleを取得し、違反がないかチェックする。
2. Sequential Thinkingを使用して、「批評(Critique)」「判定(Judge)」「修正(Refine)」のステップを明示する。
3. ループ回数をthoughtNumberで管理する。

目標: スコア95点以上の「完璧なコード」
```

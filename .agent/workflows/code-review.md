---
description: コードレビューを実行。品質、セキュリティ、保守性、パフォーマンスの観点から分析。
---

# /code-review - コードレビューコマンド

コードの品質、セキュリティ、保守性を多角的に分析します。

## レビュー観点

### 1. セキュリティ 🔒
- [ ] ハードコードされた秘密情報がないか
- [ ] SQLインジェクション対策
- [ ] XSS対策
- [ ] 入力バリデーション
- [ ] 認証・認可の適切な実装

### 2. コード品質 ✨
- [ ] DRY原則（重複コードなし）
- [ ] 単一責任の原則
- [ ] 適切な命名
- [ ] コメントの適切性
- [ ] 関数の長さ（50行以内推奨）

### 3. パフォーマンス ⚡
- [ ] N+1クエリの回避
- [ ] 適切なインデックス使用
- [ ] メモリリークの可能性
- [ ] 不要な再レンダリング（React）
- [ ] キャッシュの活用

### 4. 保守性 🔧
- [ ] テストの存在
- [ ] ドキュメントの更新
- [ ] 型定義の適切性
- [ ] エラーハンドリング
- [ ] ログ出力

## レビュー実行手順

### ステップ1: 変更ファイルの確認
```powershell
git diff --name-only HEAD~1
```

### ステップ2: 各ファイルを詳細レビュー

レビュー時のチェックリスト：

```markdown
## [ファイル名] レビュー

### セキュリティ
- ✅ 問題なし / ⚠️ 要修正: [詳細]

### コード品質
- ✅ 問題なし / ⚠️ 要修正: [詳細]

### パフォーマンス
- ✅ 問題なし / ⚠️ 要修正: [詳細]

### 保守性
- ✅ 問題なし / ⚠️ 要修正: [詳細]
```

### ステップ3: レビュー結果サマリー

```markdown
# コードレビュー結果

## 概要
- レビュー対象: X ファイル
- 問題点: Y 件（クリティカル: A, 警告: B, 情報: C）

## クリティカル問題 🔴
1. [ファイル:行] - [問題の説明]
   - 推奨修正: [修正方法]

## 警告 🟡
1. [ファイル:行] - [問題の説明]
   - 推奨修正: [修正方法]

## 情報 🔵
1. [ファイル:行] - [改善提案]

## 良い点 ✨
- [良かった実装の説明]

## 結論
[ ] 承認 - マージ可能
[ ] 要修正 - 上記問題を修正後に再レビュー
[ ] 却下 - アプローチの再検討が必要
```

## セキュリティチェックリスト詳細

### 認証・認可
```typescript
// ✅ Good
const user = await auth.verifyToken(token);
if (!user.hasPermission('admin')) {
  throw new ForbiddenError();
}

// ❌ Bad
if (req.query.isAdmin === 'true') {
  // 管理者処理
}
```

### 入力バリデーション
```typescript
// ✅ Good - Zodによるバリデーション
const schema = z.object({
  email: z.string().email(),
  age: z.number().min(0).max(150)
});

// ❌ Bad
const email = req.body.email; // 未検証
```

### SQLインジェクション
```typescript
// ✅ Good - パラメータ化クエリ
await db.query('SELECT * FROM users WHERE id = $1', [userId]);

// ❌ Bad - 文字列連結
await db.query(`SELECT * FROM users WHERE id = ${userId}`);
```

## 関連ワークフロー

- `/tdd` - テスト駆動開発
- `/refactor` - リファクタリング
- `/build-fix` - ビルドエラー修正

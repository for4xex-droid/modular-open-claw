# Modular Open Claw - プロジェクト引き継ぎ資料

## 📅 最終更新日: 2026年2月24日

## 🟢 現在のステータス: 稼働中 (TTSから動画合成までの一連のパイプラインが開通)

Samsara Protocol (Cron実行) および手動実行によるショート動画自動生成パイプラインにおいて、LLMによる台本生成 -> Qwen3-TTSによる音声合成 -> ComfyUIによる画像生成 -> FFmpegによる動画化(Ken Burnsエフェクト等) -> 全体の結合(MediaForge / SoundMixer) までのクリティカルパスが正常に動作する状態になりました。

## 🔧 直近で対応した主要な課題と修正内容

1. **TTSエンジンの切り戻し (Qwen3-TTS)**
   * `Style-Bert-VITS2` で発生していた接続エラーや品質の波を回避するため、稼働実績のある `Qwen3-TTS` にローカルサイドカーを切り戻しました。

2. **FFmpegのバックグラウンド実行時のフリーズ(SIGTTIN)解決**
   * `MediaForge` (動画・音声結合) および `SoundMixer` (BGMとナレーションのミックス) がバックグラウンドで `ffmpeg` コマンドを非同期プロセスとして実行する際、標準入力(tty)を待機してプロセスが一時停止(フリーズ)してしまう問題が発生していました。
   * 全ての `Command::new("ffmpeg")` および `ffprobe` のプロセス立ち上げ時に `.stdin(Stdio::null())` を明示的に指定することで、バックグラウンドでのデッドロックを完全に解消しました。これでスタックせずに最後まで走り切ります。

3. **アウトロ(エンディング)におけるナレーションのテンポ遅延の解消**
   * 自己回帰型TTSモデル特有の「短いエンディング文で勝手にテンションと速度を落としてしまう」現象に対し、TTSリクエストパラメータに `speed` (読み上げ速度) を指定できる機能を新規追加しました。
   * `ProductionOrchestrator` の生成ループ内にて、`act_name == "outro"` の場合のみ強制的に `speed: 1.15` (15%倍速) をかけてリクエストを投げるよう制御を追加実装し、動画の締めくくりがダレないようにしました。

## 🚀 次のステップ (Next Actions)

新しいチャットセッションにて、以下のいずれかの改善・拡張を進めることができます。

* **生成品質の向上:**
  * LLM(Gemini) が生成する画像プロンプト (`visual_prompts`) の最適化。
  * `ComfyUI` 側のワークフローJSON (`shorts_standard_v1.json`) のブラッシュアップ（よりShorts映えするLoRAやエフェクトの追加）。
* **UI/UXの拡張:**
  * Command Center (Web UI) からのジョブ管理、生成状況のプログレスバーによるリアルタイム監視機能の強化。
  * スタイル (`styles.toml`) の画面からの動的切り替え。
* **Samsara Protocol の自律性強化:**
  * 生成された動画の品質を AI 自らが評価（Lex AI）し、良かったプロンプトやパラメータを Karma として蓄積する学習ループの本格稼働。

---
*それでは、新しいチャットでお待ちしております！*

# Watchtower 対話システム仕様書 (v1.1)

## 概要
Watchtower（OpenClaw）は、動画生成ファクトリー `shorts-factory` の守護者であり、ユーザー（マスター）と Discord を通じて直接対話する能力を持ちます。現在は「雑談」と「システム操作」の2つのチャンネル、および「ログ監視」の合計3つのエンドポイントを使い分け、より自律的なエージェントとして動作します。

---

## 🏗️ 技術アーキテクチャ

### 1. 通信経路とチャンネルの役割
用途に応じて Discord のチャンネルを使い分ける「チャンネル分離（Channel Separation）」を採用しています。

| チャンネル構成 | 環境変数 | エンジン | 役割 |
| :--- | :--- | :--- | :--- |
| **雑談チャンネル** | `DISCORD_CHAT_CHANNEL_ID` | ローカル LLM | 通常の対話、関係性の構築。スラッシュコマンド不要で直接発言可能。 |
| **コマンドセンター** | `DISCORD_COMMAND_CHANNEL_ID` | Gemini 2.0 | システム操作（ジョブ確認、生成指示）。Intent解析機能付き。 |
| **ログチャンネル** | `DISCORD_LOG_CHANNEL_ID` | - | システムログの監視、承認リクエストの受け取り。 |

### 2. 人格形成 (Identity)
- **ソース**: `SOUL.md`
- **適用方式**: 全てのプロンプトに「魂（人格定義）」として Preamble（前文）を挿入。
- **自律的発言 (Proactive Talk)**:
    *   **モーニング・ブレス**: 毎朝 09:00 に自発的に挨拶を行います。
    *   **記憶の整理報告**: 毎晩 01:30 のメモリー蒸留完了後に、気づきを報告します。

---

## 🧠 思考エンジン構成 (Hybrid Engine)

| モード | 使用モデル | 特徴 |
| :--- | :--- | :--- |
| **Chat Mode** | `mistral-small` 等 | 人格を重視した高速な応答。プライバシーと個性を守ります。 |
| **Command Mode** | `Gemini 2.0 Flash` | 高度な論理推論とシステム連携。正確なコマンド実行に特化。 |

---

## ⚙️ 運用モード (Operational Modes)

### 1. Samsara 全稼働モード (Active Loop)
- **状態**: `shorts-factory` 内の Cron スケジューラが有効。
- **動作**: 24時間体制でトレンド収集、企画、動画生成、および自律的な話しかけを実行。
- **特徴**: まるで生きているかのように Watchtower が活動し、適宜マスターに報告を上げます。

### 2. 対話特化モード (Chat-only Mode)
- **状態**: Cron スケジューラをオフにして起動。
- **動作**: 動画生成を停止し、対話リソースを最大化。巨大なモデルのロードに適しています。

---

## 🛠️ セットアップ
環境変数（`.env` またはシステム環境変数）に以下のIDを設定してください。
```bash
DISCORD_TOKEN=...
DISCORD_LOG_CHANNEL_ID=123... (通知・ログ用)
DISCORD_COMMAND_CHANNEL_ID=123... (Gemini連携・操作用)
DISCORD_CHAT_CHANNEL_ID=123... (ローカルLLMとの対話用)
```

---

更新日: 2026-02-24
管理者: Antigravity / Watchtower System
